# 详解Hive和MySQL中常用窗口函数 🕹️0.1.0  

虽然在工作学习中，我最讨厌的就是死记硬背，但是sql中的函数只能通过记忆的方式，才能在工作中通过不断的组合练习熟练使用，今天我希望总结一下Hive和MySQL中常用的窗口函数~


## 什么是窗口函数
1. 首先，`窗口`就是记录集合  
2. 而`窗口函数`就是在满足某些条件的记录集合上执行的特殊函数，对于每条记录都要在此窗口内执行函数  
3. 有的函数随着记录的不同，窗口大小都是固定的，称为`静态窗口`  
4. 有的函数则相反，不同的记录对应着不同的窗口，称为`滑动窗口`  


## 窗口函数的基本语法
```
函数名() OVER(子句)  
```
1. `over`关键字用来指定函数执行的窗口范围  
2. 若后面括号中什么都不写，则意味着窗口包含满足`where`条件的所有行，窗口函数基于所有行进行计算  
3. 若后面括号中不为空，则支持以下四种语法来设置窗口:
	+ `as window_name(别名)` 给窗口指定一个别名，如果sql中涉及的窗口较多，采用别名可以看起来更清晰易读，`as`可以省略  
	+ `partition by 子句` 窗口按照哪些字段进行分组，窗口函数在不同的分组上分别执行  
	+ `order by 子句` 按照哪些字段进行排序，窗口函数将按照排序后的记录顺序进行编号  
	+ `frame 子句` `frame`是当前分区的一个子集，子句用来定义子集的规则，通常用来作为滑动窗口使用  


## 常用窗口函数
### MySQL中的窗口函数
[这篇文章总结的相当到位了](https://blog.csdn.net/mmdzm/article/details/117448192)  
1. 序号函数，显示分区中的当前行号
	+ ROW_NUMBER()  
	+ RANK()  
	+ DENSE_RANK()  
2. 分布函数，每行按照公式`(rank-1) / (rows-1)`进行计算。其中，`rank`为`RANK()`函数产生的序号，`rows`为当前窗口的记录总行数  
	+ PERCENT_RANK()  
	+ CUME_DIST()  
3. 前后函数，返回位于当前行的前n行或后n行的col（某字段）的值  
	+ LAG(col,n,defaul)  
	+ LEAD(col,n,defaul)  
	```
	# 第一个参数为列名  
	# 第二个参数为往上第`n`行（可选，默认为`1`）  
	# 第三个参数为默认值（当往上第`n`行为`NULL`时候，取默认值，如不指定，则为`NULL`）  
	```
1. 头尾函数，返回第一个或最后一个col（某字段）的值  
	+ FIRST_VALUE(col)  
	+ LAST_VALUE(col)  
5. 其它函数
	+ NTH_VALUE(expr, n) 返回窗口中第n个expr的值，expr可以是表达式，也可以是列名  
	+ NTILE(n) 将分区中的有序数据分为n个等级，记录等级数  

### Hive中的窗口函数
+ [HIVE开窗函数](https://blog.csdn.net/weixin_46602525/article/details/117791073)  
+ 查阅更多资料，并准备至少三个生产环境可能会遇到的问题  


我是 [fx67ll.com](https://fx67ll.com)，如果您发现本文有什么错误，欢迎在评论区讨论指正，感谢您的阅读！  
如果您喜欢这篇文章，欢迎访问我的 [本文github仓库地址](https://github.com/fx67ll/fx67llBigData/blob/main/note/hive/hive-windowapi-inwork.md)，为我点一颗Star，Thanks~ :)  
***转发请注明参考文章地址，非常感谢！！！***